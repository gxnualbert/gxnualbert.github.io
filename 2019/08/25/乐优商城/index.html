<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>乐优商城 | gxnualbert</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">乐优商城</h1><a id="logo" href="/.">gxnualbert</a><p class="description">触底反弹，奋力前行，加油！</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">乐优商城</h1><div class="post-meta">Aug 25, 2019</div><div class="post-content"><p>创建spring boot项目，想让spring来帮忙构建，必须以spring boot作为父pom，如下：</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1566712130746.png" alt="1566712130746"></p>
<p>SpringBoot 属性注入方式一</p>
<p>springboot是如何消灭xml的?</p>
<p>java注解的方式VS xml 方式</p>
<p>@configuration = xml文件</p>
<p>@Bean = <bean></bean></p>
<p>@value = &lt;property 属性注入&gt; 只能注入基本的类型，不能注入复杂的类型</p>
<p>@PropertySource = <img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567318418880.png" alt="1567318418880"></p>
<p>要调用你代码的人，他只需要引一个maven坐标即可。</p>
<p>interface包：主要是放相关的实体类；</p>
<p>service包：相关的业务逻辑及几口实现</p>
<p>分页助手pagehelper：完成mysql分页查询</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567391190352.png" alt="1567391190352"></p>
<p>在双引号中，点击小灯泡或者alt+enter，选择”inject language or reference”,然后再选json。最后再在双引号中alt+enter，选择edit json，就 弹出如下编辑框：</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567392048840.png" alt="1567392048840"></p>
<p>选择edit json，就 弹出如下编辑框，我们在下面直接写json，idea会帮我们自动转义</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567391743652.png" alt="1567391743652"></p>
<p>ResponseBody 和ResponseEntity区别</p>
<p>ResponseBody 响应体，作用是把Java对象序列化（默认是json），放到body里面去，但是不包含响应码；ResponseEntity是一个完整的http响应，里面包括响应码，响应体，header，，它是一个完整的http响应。</p>
<p>统一异常处理：把所有的异常都拦截下来，自己处理。把所有controller的异常都拦截下来，把web层异常拦截下来，基本所有异常都已经被拦截下来了。—–&gt;AOP思想，可以用AOP，也可以用spring的mvc</p>
<p>@ControllerAdvice 默认情况下，自动拦截所有的controller</p>
<p>自定义异常</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567397608531.png" alt="1567397608531"></p>
<h4 id="自定义异常的引入"><a href="#自定义异常的引入" class="headerlink" title="自定义异常的引入"></a>自定义异常的引入</h4><p>有时候，在controller层，当客户端发送过来的请求，不包含价格时（正确的请求应该是名称+价格）。我们需要校验客户端发送过来的请求参数是否完整，并且合法，如果不合法，直接抛出异常返回给客户端，并告知请求失败原因。大概的思路有两种：1采用aop思想，拦截所有controller的请求，然后对请求参数进行校验；2采用springmvc自带的异常拦截，自定义异常实现类。</p>
<p>一般用枚举对异常进行描述，如下：</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567398561837.png" alt="1567398561837"></p>
<p>由于我们返回给客户端是一个完整的http请求，所以不能用responsebody，要用ResponseEntity（包含请求行，请求头，请求体，状态码）</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567398673997.png" alt="1567398673997"></p>
<p>总体是思路（上图）：@ControllerAdvice注解下的类，将会拦截所有controller的异常，然后交给@ExceptionHandler处理，处理完后，返回一个ResponseEntity包含请求行，请求头，请求体，状态码）。</p>
<h4 id="Nginx以及品牌管理"><a href="#Nginx以及品牌管理" class="headerlink" title="Nginx以及品牌管理"></a>Nginx以及品牌管理</h4><p>域名解析问题–Nginx–</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567399152001.png" alt="1567399152001"></p>
<p>访问浏览器的时候，通过IP地址访问不好，应该使用域名访问。</p>
<p>提供给客户使用的是<a href="http://www.leyou.com(一级域名),而后台管理系统，使用manage.leyou.com(二级域名)。在浏览器中输入域名的时候，浏览器DNS会将域名解析成IP和端口，浏览器实际拿到的也是ip和端口" target="_blank" rel="noopener">www.leyou.com(一级域名),而后台管理系统，使用manage.leyou.com(二级域名)。在浏览器中输入域名的时候，浏览器DNS会将域名解析成IP和端口，浏览器实际拿到的也是ip和端口</a></p>
<p>域名解析：先本地host文件解析，如果解析成功，就返回给浏览器；如果解析失败，就去请求域名解析服务器。</p>
<p>Nginx静态资源服务器（js，css）Nginx不能解析jsp等页面，只能处理js、css、html等静态资源。</p>
<p>Tomcat动态资源服务器</p>
<p>make &amp;&amp; make install: &amp;&amp; 是短路与，第一个成功，执行第二个；第一个失败，不执行第二个。</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567402787331.png" alt="1567402787331"></p>
<p>如图，Nginx启动成功之后，有两个进程，master（主进程）的作用是监控和管理；worker（工作进程）的作用是处理用户的请求并且响应。</p>
<p>service IPtable off：关闭防火墙。</p>
<p>管道是Linux命令中重要的一个概念，其作用是将一个命令的输出用作另一个命令的输入</p>
<p>Nginx配置文件：</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567410285376.png" alt="1567410285376"></p>
<p>如果请求的链接一个都匹配不上Nginx中的地址，则使用Nginx配置文件中，第一个server作为匹配结果。</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567410477698.png" alt="1567410477698"></p>
<p>Nginx -s reload 重新加载配置文件</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567412025248.png" alt="1567412025248"></p>
<p>浏览器发起域名(manage.leyou.com)请求,然后经过本地域名解析，拿到的ip是192.168.58.101，由于请求的时候，没加端口，所以，默认端口是80.因此，经过域名解析后，浏览器就拿到了完整ip，port。</p>
<p>浏览器向192.168.58.101:80发起请求，被Nginx监听到了，Nginx根据配置文件的配置，反向代理，将请求转发到192.168.58.2:9001去。</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567412184923.png" alt="1567412184923"></p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567412490975.png" alt="1567412490975"></p>
<p>配置VMware 的centos网络，让Windows的xshell能连接</p>
<p>参考连接<a href="https://www.cnblogs.com/shireenlee4testing/p/9469650.html，配置好虚拟机网络。" target="_blank" rel="noopener">https://www.cnblogs.com/shireenlee4testing/p/9469650.html，配置好虚拟机网络。</a></p>
<p>然后参考连接<a href="https://www.cnblogs.com/sunlong88/articles/9195909.html，配置好centos里面的网络配置文件，如下：" target="_blank" rel="noopener">https://www.cnblogs.com/sunlong88/articles/9195909.html，配置好centos里面的网络配置文件，如下：</a></p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567414582972.png" alt="1567414582972"></p>
<p>centos 编译安装Nginx</p>
<p>./configure –prefix=/usr/local/nginx –sbin-path=/usr/bin/nginx</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567417968565.png" alt="1567417968565"></p>
<p>妈的，这个鬼东西，花了我好多时间。刚刚开始，我就是想用阿里云的来配置的。去阿里云看了一下，有Nginx，并且能跑起来。但是，在Windows中，不能访问Nginx。我以为是Nginx安装有问题。</p>
<p>后来，我就自己安装虚拟机，虚拟机安装好了，又用centos镜像安装，安装失败，镜像的问题，然后又去网上下载了一个镜像，安装成功。然后配置网络，让我本地的Windows能通过xshell访问虚拟机上的centos。访问成功后，过一段时间，又不能访问。后面又折腾回阿里云。在阿里云安装了好几次Nginx，都提示</p>
<p>make[1]: Leaving directory `/usr/local/nginx-1.10.0’</p>
<p>我以为有问题，实际是没有问题的。ps也能看到进程。</p>
<p>最后，才怀疑端口的问题。最后，配置了端口之后，一切访问顺利！！！！！！！！</p>
<p>如下所示，通过域名访问后台管理系统成功：</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567421555465.png" alt="1567421555465"></p>
<p>主要流程：浏览器访问<a href="http://manage.leyou.com/" target="_blank" rel="noopener">http://manage.leyou.com</a>，通过如下的映射，解析出Nginx的服务器地址，Nginx在根据80端口及manage.leyou.com匹配出需要转发的地址是<a href="http://192.168.1.104:9001，于是浏览器就直接访问这个地址了。" target="_blank" rel="noopener">http://192.168.1.104:9001，于是浏览器就直接访问这个地址了。</a></p>
<p>host映射配置：</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567421766263.png" alt="1567421766263"></p>
<p>Nginx配置：</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567421820572.png" alt="1567421820572"></p>
<h4 id="URL是如何拼接的？"><a href="#URL是如何拼接的？" class="headerlink" title="URL是如何拼接的？"></a>URL是如何拼接的？</h4><p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567422759330.png" alt="1567422759330"></p>
<p>如图，在浏览器中，请求的是一个完整的URL，但是在vue项目中，只有后半部分URL。</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567422833565.png" alt="1567422833565"></p>
<p>他们是怎么拼接的呢？请看如下js文件：</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567422887706.png" alt="1567422887706"></p>
<h4 id="前端请求路劲是如何被后台拦截的？"><a href="#前端请求路劲是如何被后台拦截的？" class="headerlink" title="前端请求路劲是如何被后台拦截的？"></a>前端请求路劲是如何被后台拦截的？</h4><p>如下所示，前端中，单独独立一个${baseUrl}/api，主要是为了让网管zuul匹配上的</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567423343626.png" alt="1567423343626"></p>
<p>，zuul的配置如下：</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567423419909.png" alt="1567423419909"></p>
<p>而/item/category是为了让item匹配到的</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567423459387.png" alt="1567423459387"></p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567423524334.png" alt="1567423524334"></p>
<p>然后，zuul就会把这个请求转发到商品微服务去：</p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567423644766.png" alt="1567423644766"></p>
<p>所以，url <a href="http://api.leyou.com/api/item/category/list?pid=0就是通过上述一步步被拆解出来的" target="_blank" rel="noopener">http://api.leyou.com/api/item/category/list?pid=0就是通过上述一步步被拆解出来的</a></p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567423709506.png" alt="1567423709506"></p>
<h4 id="Unable-to-round-trip-http-request-to-upstream-lookup"><a href="#Unable-to-round-trip-http-request-to-upstream-lookup" class="headerlink" title="Unable to round-trip http request to upstream: lookup"></a>Unable to round-trip http request to upstream: lookup</h4><p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567431520939.png" alt="1567431520939"></p>
<p>如图，无法访问，下面<a href="http://manage.leyou.com/#/index也无法访问。刚刚放完还好好的，不知道一下为啥就不行了。" target="_blank" rel="noopener">http://manage.leyou.com/#/index也无法访问。刚刚放完还好好的，不知道一下为啥就不行了。</a></p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567431552434.png" alt="1567431552434"></p>
<p>Google出来，原来是因为我开了蓝灯。我刚刚开了蓝灯，装了一个json插件，装完后，忘记关闭蓝灯了。</p>
<p>退出蓝灯后，一切正常。</p>
<p>参考：<a href="https://my.oschina.net/u/3964246/blog/2208060" target="_blank" rel="noopener">https://my.oschina.net/u/3964246/blog/2208060</a></p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567431699871.png" alt="1567431699871"></p>
<h4 id="sockjs-node-vue-项目一直出现-sockjs-node-info-t-1554978"><a href="#sockjs-node-vue-项目一直出现-sockjs-node-info-t-1554978" class="headerlink" title="/sockjs-node   vue 项目一直出现 sockjs-node/info?t=1554978"></a>/sockjs-node   vue 项目一直出现 sockjs-node/info?t=1554978</h4><p>参考<a href="https://blog.csdn.net/gulang03/article/details/89217273" target="_blank" rel="noopener">https://blog.csdn.net/gulang03/article/details/89217273</a></p>
<p><img src="//yoursite.com/2019/08/25/乐优商城/D:%5Cblog%5Csource_posts%5C%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%5C1567433442742.png" alt="1567433442742"></p>
<p>cors解决跨域问题</p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2019/08/29/SpringBoot相关/">SpringBoot相关</a><a class="next" href="/2019/08/25/Maven/">Maven</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Maven/" style="font-size: 15px;">Maven</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/spring-junit/" style="font-size: 15px;">spring-junit</a> <a href="/tags/ssm/" style="font-size: 15px;">ssm</a> <a href="/tags/各种快捷键/" style="font-size: 15px;">各种快捷键</a> <a href="/tags/MuseScore/" style="font-size: 15px;">MuseScore</a> <a href="/tags/常用注解/" style="font-size: 15px;">常用注解</a> <a href="/tags/Spring-MVC/" style="font-size: 15px;">Spring MVC</a> <a href="/tags/SSM/" style="font-size: 15px;">SSM</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/08/29/SpringBoot相关/">SpringBoot相关</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/25/乐优商城/">乐优商城</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/25/Maven/">Maven</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/15/吉他谱软件使用/">吉他谱软件使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/12/SSM主流框架集成/">SSM主流框架集成</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/10/常用注解/">常用注解</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/09/Spring整合Junit配置/">Spring整合Junit配置 </a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/06/SpringMVC-Spring-Mybatis-整合/">SpringMVC Spring Mybatis 整合</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/06/常用快捷键/">常用快捷键</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/05/Spring-MVC-基础第一天/">Spring MVC 基础第一天</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">gxnualbert.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>